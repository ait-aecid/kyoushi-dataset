
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="IDS Dataset processing and labeling tool.">
      
      
      
      
        <link rel="canonical" href="https://ait-aecid.github.io/kyoushi-dataset/rules/">
      
      <link rel="shortcut icon" href="../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-6.2.8">
    
    
      
        <title>Labeling Rules - Cyber Range Kyoushi Dataset</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.39b8e14a.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../stylesheets/jquery.fancybox.min.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="ait" data-md-color-primary="" data-md-color-accent="">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#labeling-rules" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://ait-aecid.github.io/kyoushi-dataset/" title="Cyber Range Kyoushi Dataset" class="md-header-nav__button md-logo" aria-label="Cyber Range Kyoushi Dataset">
      
  <img src="../images/cr_icon.svg" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            Cyber Range Kyoushi Dataset
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Labeling Rules
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/ait-aecid/kyoushi-dataset/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    kyoushi-dataset
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://ait-aecid.github.io/kyoushi-dataset/" title="Cyber Range Kyoushi Dataset" class="md-nav__button md-logo" aria-label="Cyber Range Kyoushi Dataset">
      
  <img src="../images/cr_icon.svg" alt="logo">

    </a>
    Cyber Range Kyoushi Dataset
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/ait-aecid/kyoushi-dataset/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    kyoushi-dataset
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" >
      
      <label class="md-nav__link" for="nav-2">
        Getting Started
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
        <label class="md-nav__title" for="nav-2">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/intro/" class="md-nav__link">
        Intro
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/prepare/" class="md-nav__link">
        Prepare Dataset
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/process/" class="md-nav__link">
        Process Dataset
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/label/" class="md-nav__link">
        Label Dataset
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/sample/" class="md-nav__link">
        Sample Labels
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" >
      
      <label class="md-nav__link" for="nav-3">
        Examples
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Examples" data-md-level="1">
        <label class="md-nav__title" for="nav-3">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../examples/process/" class="md-nav__link">
        Dataset Processing
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../processors/" class="md-nav__link">
        Dataset Processors
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Labeling Rules
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Labeling Rules
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dsl-query-rule-elasticsearchquery" class="md-nav__link">
    DSL Query Rule (elasticsearch.query)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#eql-sequence-rule-elasticsearchsequence" class="md-nav__link">
    EQL Sequence Rule (elasticsearch.sequence)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dsl-sub-query-rule-elasticsearchsub_query" class="md-nav__link">
    DSL Sub Query Rule (elasticsearch.sub_query)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dsl-parent-query-rule-elasticsearchparent_query" class="md-nav__link">
    DSL Parent Query Rule (elasticsearch.parent_query)
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        CLI Reference
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" >
      
      <label class="md-nav__link" for="nav-7">
        Code Reference
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Code Reference" data-md-level="1">
        <label class="md-nav__title" for="nav-7">
          <span class="md-nav__icon md-icon"></span>
          Code Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../reference/config/" class="md-nav__link">
        Config
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../reference/elasticsearch/" class="md-nav__link">
        Elasticsearch
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../reference/labels/" class="md-nav__link">
        Labels
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../reference/parser/" class="md-nav__link">
        Parser
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../reference/pcap/" class="md-nav__link">
        PCAP Utilities
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../reference/processors/" class="md-nav__link">
        Processors
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../reference/sample/" class="md-nav__link">
        Sampling
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../reference/templates/" class="md-nav__link">
        Templates
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../reference/utils/" class="md-nav__link">
        Utility Functions
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../license/" class="md-nav__link">
        License
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dsl-query-rule-elasticsearchquery" class="md-nav__link">
    DSL Query Rule (elasticsearch.query)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#eql-sequence-rule-elasticsearchsequence" class="md-nav__link">
    EQL Sequence Rule (elasticsearch.sequence)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dsl-sub-query-rule-elasticsearchsub_query" class="md-nav__link">
    DSL Sub Query Rule (elasticsearch.sub_query)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dsl-parent-query-rule-elasticsearchparent_query" class="md-nav__link">
    DSL Parent Query Rule (elasticsearch.parent_query)
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ait-aecid/kyoushi-dataset/edit/main/docs/rules.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="labeling-rules">Labeling Rules<a class="headerlink" href="#labeling-rules" title="Permanent link">&para;</a></h1>
<p>On this page you can learn about the various labeling rules available with Cyber Range Kyoushi Dataset.</p>
<h2 id="dsl-query-rule-elasticsearchquery">DSL Query Rule (<code>elasticsearch.query</code>)<a class="headerlink" href="#dsl-query-rule-elasticsearchquery" title="Permanent link">&para;</a></h2>


  <div class="doc doc-object doc-class">


    <div class="doc doc-contents first">

      <p>Applies labels based on a simple Elasticsearch DSL query.</p>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">elasticsearch.query</span><span class="w"></span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">attacker.foothold.vpn.ip</span><span class="w"></span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">attacker_vpn</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foothold</span><span class="w"></span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;-</span><span class="w"></span>
<span class="w">    </span><span class="no">This rule applies the labels to all openvpn log rows that have</span><span class="w"></span>
<span class="w">    </span><span class="no">the attacker server as source ip and are within the foothold phase.</span><span class="w"></span>
<span class="w">  </span><span class="nt">index</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openvpn-vpn</span><span class="w"></span>
<span class="w">  </span><span class="nt">filter</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">range</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="s">&quot;@timestamp&quot;</span><span class="p p-Indicator">:</span><span class="w"></span>
<span class="w">        </span><span class="c1"># foothold phase start</span><span class="w"></span>
<span class="w">        </span><span class="nt">gte</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2021-03-23</span><span class="nv"> </span><span class="s">20:31:00+00:00&quot;</span><span class="w"></span>
<span class="w">        </span><span class="c1"># foothold phase stop</span><span class="w"></span>
<span class="w">        </span><span class="nt">lte</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2021-03-23</span><span class="nv"> </span><span class="s">21:13:52+00:00&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">query</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">match</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">source.ip</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;192.42.0.255&#39;</span><span class="w"></span>
</code></pre></div>




  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateByQueryRule.description">
<code class="highlight language-python"><span class="n">description</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateByQueryRule.description" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>An optional description for the rule</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateByQueryRule.exclude">
<code class="highlight language-python"><span class="n">exclude</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateByQueryRule.exclude" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Similar to filters, but used to exclude results</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateByQueryRule.filter_">
<code class="highlight language-python"><span class="n">filter_</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateByQueryRule.filter_" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The filter/s to limit queried to documents to only those that match the filters</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateByQueryRule.id_">
<code class="highlight language-python"><span class="n">id_</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
      <small class="doc doc-property doc-property-required"><code>required</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateByQueryRule.id_" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The unique rule id</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateByQueryRule.index">
<code class="highlight language-python"><span class="n">index</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateByQueryRule.index" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The indices to query (by default prefixed with the dataset name)</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateByQueryRule.indices_prefix_dataset">
<code class="highlight language-python"><span class="n">indices_prefix_dataset</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateByQueryRule.indices_prefix_dataset" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>If set to true the <code>&lt;DATASET.name&gt;-</code> is automatically prefixed to each pattern. This is a convenience setting as per default all dataset indices start with this prefix.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateByQueryRule.labels">
<code class="highlight language-python"><span class="n">labels</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
      <small class="doc doc-property doc-property-required"><code>required</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateByQueryRule.labels" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The list of labels to apply to log lines matching this rule</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateByQueryRule.query">
<code class="highlight language-python"><span class="n">query</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
      <small class="doc doc-property doc-property-required"><code>required</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateByQueryRule.query" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The query/s to use for identifying log lines to apply the tags to.</p>
    </div>

  </div>




  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateByQueryRule.type_field">
<code class="highlight language-python"><span class="n">type_field</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
      <small class="doc doc-property doc-property-required"><code>required</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateByQueryRule.type_field" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The rule type as passed in from the config</p>
    </div>

  </div>









  </div>

    </div>

  </div>

<h2 id="eql-sequence-rule-elasticsearchsequence">EQL Sequence Rule (<code>elasticsearch.sequence</code>)<a class="headerlink" href="#eql-sequence-rule-elasticsearchsequence" title="Permanent link">&para;</a></h2>


  <div class="doc doc-object doc-class">


    <div class="doc doc-contents first">

      <p>Applies labels to a sequence of log events defined by an EQL query.</p>
<p>This labeling rule is defined as an
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/master/eql.html">EQL query</a>.
Using this syntax it is possible to define a sequence of related events and retrieve
them. All events part of retrieved sequences are then labeled.</p>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">elasticsearch.sequence</span><span class="w"></span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">attacker.webshell.upload.seq</span><span class="w"></span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">webshell_upload</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;-</span><span class="w"></span>
<span class="w">    </span><span class="no">This rule labels the web shell upload step by matching the 3 step sequence</span><span class="w"></span>
<span class="w">    </span><span class="no">within the foothold phase.</span><span class="w"></span>
<span class="w">  </span><span class="nt">index</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apache_access-intranet_server</span><span class="w"></span>
<span class="w">  </span><span class="c1"># since we do these requests very fast</span><span class="w"></span>
<span class="w">  </span><span class="c1"># we need the line number as tie breaker</span><span class="w"></span>
<span class="w">  </span><span class="nt">tiebreaker_field</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">log.file.line</span><span class="w"></span>
<span class="w">  </span><span class="nt">by</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">source.address</span><span class="w"></span>
<span class="w">  </span><span class="nt">max_span</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2m</span><span class="w"></span>
<span class="w">  </span><span class="nt">filter</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">range</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;@timestamp&quot;</span><span class="p p-Indicator">:</span><span class="w"></span>
<span class="w">        </span><span class="c1"># foothold phase start</span><span class="w"></span>
<span class="w">        </span><span class="nt">gte</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2021-03-23</span><span class="nv"> </span><span class="s">20:31:00+00:00&quot;</span><span class="w"></span>
<span class="w">        </span><span class="c1"># foothold phase stop</span><span class="w"></span>
<span class="w">        </span><span class="nt">lte</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2021-03-23</span><span class="nv"> </span><span class="s">21:13:52+00:00&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">sequences</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;[</span><span class="nv"> </span><span class="s">apache</span><span class="nv"> </span><span class="s">where</span><span class="nv"> </span><span class="s">event.action</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&quot;access&quot;</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">url.original</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&quot;/&quot;</span><span class="nv"> </span><span class="s">]&#39;</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;[</span><span class="nv"> </span><span class="s">apache</span><span class="nv"> </span><span class="s">where</span><span class="nv"> </span><span class="s">event.action</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&quot;access&quot;</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">url.original</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&quot;/?p=5&quot;</span><span class="nv"> </span><span class="s">]&#39;</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;[</span><span class="nv"> </span><span class="s">apache</span><span class="nv"> </span><span class="s">where</span><span class="nv"> </span><span class="s">event.action</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&quot;access&quot;</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">http.request.method</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&quot;POST&quot;</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">url.original</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&quot;/wp-admin/admin-ajax.php&quot;</span><span class="nv"> </span><span class="s">]&#39;</span><span class="w"></span>
</code></pre></div>




  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.EqlSequenceRule.batch_size">
<code class="highlight language-python"><span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.EqlSequenceRule.batch_size" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The amount of sequences to update with each batch. Cannot be bigger than <code>max_result_window</code></p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.EqlSequenceRule.by">
<code class="highlight language-python"><span class="n">by</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.EqlSequenceRule.by" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Optional global sequence by fields</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.EqlSequenceRule.description">
<code class="highlight language-python"><span class="n">description</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.EqlSequenceRule.description" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>An optional description for the rule</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.EqlSequenceRule.event_category_field">
<code class="highlight language-python"><span class="n">event_category_field</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.EqlSequenceRule.event_category_field" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The field used to categories events</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.EqlSequenceRule.filter_">
<code class="highlight language-python"><span class="n">filter_</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.EqlSequenceRule.filter_" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The filter/s to limit queried to documents to only those that match the filters</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.EqlSequenceRule.id_">
<code class="highlight language-python"><span class="n">id_</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
      <small class="doc doc-property doc-property-required"><code>required</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.EqlSequenceRule.id_" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The unique rule id</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.EqlSequenceRule.index">
<code class="highlight language-python"><span class="n">index</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.EqlSequenceRule.index" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The indices to query (by default prefixed with the dataset name)</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.EqlSequenceRule.indices_prefix_dataset">
<code class="highlight language-python"><span class="n">indices_prefix_dataset</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.EqlSequenceRule.indices_prefix_dataset" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>If set to true the <code>&lt;DATASET.name&gt;-</code> is automatically prefixed to each pattern. This is a convenience setting as per default all dataset indices start with this prefix.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.EqlSequenceRule.labels">
<code class="highlight language-python"><span class="n">labels</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
      <small class="doc doc-property doc-property-required"><code>required</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.EqlSequenceRule.labels" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The list of labels to apply to log lines matching this rule</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.EqlSequenceRule.max_result_window">
<code class="highlight language-python"><span class="n">max_result_window</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.EqlSequenceRule.max_result_window" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The max result window allowed on the elasticsearch instance</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.EqlSequenceRule.max_span">
<code class="highlight language-python"><span class="n">max_span</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.EqlSequenceRule.max_span" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Optional max time span in which a sequence must occur to be considered a match</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.EqlSequenceRule.sequences">
<code class="highlight language-python"><span class="n">sequences</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
      <small class="doc doc-property doc-property-required"><code>required</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.EqlSequenceRule.sequences" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Event sequences to search. Must contain at least two events.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.EqlSequenceRule.tiebreaker_field">
<code class="highlight language-python"><span class="n">tiebreaker_field</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.EqlSequenceRule.tiebreaker_field" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Optional, string) Field used to sort hits with the same timestamp in ascending order.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.EqlSequenceRule.timestamp_field">
<code class="highlight language-python"><span class="n">timestamp_field</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.EqlSequenceRule.timestamp_field" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The field containing the event timestamp</p>
    </div>

  </div>




  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.EqlSequenceRule.type_field">
<code class="highlight language-python"><span class="n">type_field</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
      <small class="doc doc-property doc-property-required"><code>required</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.EqlSequenceRule.type_field" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The rule type as passed in from the config</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.EqlSequenceRule.until">
<code class="highlight language-python"><span class="n">until</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.EqlSequenceRule.until" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Optional until event marking the end of valid sequences. The until event will not be labeled.</p>
    </div>

  </div>









  </div>

    </div>

  </div>

<h2 id="dsl-sub-query-rule-elasticsearchsub_query">DSL Sub Query Rule (<code>elasticsearch.sub_query</code>)<a class="headerlink" href="#dsl-sub-query-rule-elasticsearchsub_query" title="Permanent link">&para;</a></h2>


  <div class="doc doc-object doc-class">


    <div class="doc doc-contents first">

      <p>Labeling rule that labels the results of multiple sub queries.</p>
<p>This labeling rule first executes a base query to retrieve information.
It then renders and executes a templated sub query for each row retrieved
from the base query. The result rows of these dynamically generated sub queries
are then labled.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The sub query uses Jinja2 syntax for templating. The information retrieved
by the base query can be accessed through the <code>HIT</code> variable.</p>
</div>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">elasticsearch.sub_query</span><span class="w"></span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">attacker.foothold.apache.access_dropped</span><span class="w"></span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">attacker_http</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foothold</span><span class="w"></span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;-</span><span class="w"></span>
<span class="w">    </span><span class="no">This rule tries to match attacker requests that we where unable to</span><span class="w"></span>
<span class="w">    </span><span class="no">match to a labeled response with access log entries. Such cases can</span><span class="w"></span>
<span class="w">    </span><span class="no">happen if the corresponding response gets lost in the network or</span><span class="w"></span>
<span class="w">    </span><span class="no">otherwise is not sent.</span><span class="w"></span>
<span class="w">  </span><span class="nt">index</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pcap-attacker_0</span><span class="w"></span>
<span class="w">  </span><span class="c1"># obligatory match all</span><span class="w"></span>
<span class="w">  </span><span class="nt">query</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">term</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">destination.ip</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;172.16.0.217&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">filter</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">term</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">event.category</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">term</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">event.action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">request</span><span class="w"></span>
<span class="w">    </span><span class="c1"># we are looking for requests that have not been marked as attacker http yet</span><span class="w"></span>
<span class="w">    </span><span class="c1"># most likely they did not have a matching response due to some network error</span><span class="w"></span>
<span class="w">    </span><span class="c1"># or timeout</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">bool</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">must_not</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">script</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">script</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test_dataset_kyoushi_label_filter</span><span class="w"></span>
<span class="w">                </span><span class="nt">params</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="nt">labels</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">attacker_http</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">  </span><span class="nt">sub_query</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">index</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apache_access-intranet_server</span><span class="w"></span>
<span class="w">    </span><span class="nt">query</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">term</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">url.full</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">HIT.url.full</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">term</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">source.address</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;172.16.100.151&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">filter</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">range</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="s">&quot;@timestamp&quot;</span><span class="p p-Indicator">:</span><span class="w"></span>
<span class="w">            </span><span class="c1"># the access log entry should be after the request, but since the access log</span><span class="w"></span>
<span class="w">            </span><span class="c1"># does not have microseconds we drop them here as well</span><span class="w"></span>
<span class="w">            </span><span class="nt">gte</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">(HIT[&#39;@timestamp&#39;]</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">as_datetime).replace(microsecond=0)</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="w"></span>
<span class="w">            </span><span class="c1"># the type of error we are looking for should create an access log entry almost immediately</span><span class="w"></span>
<span class="w">            </span><span class="c1"># se we keep the time frame short</span><span class="w"></span>
<span class="w">            </span><span class="nt">lte</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">(</span><span class="nv"> </span><span class="s">HIT[&#39;@timestamp&#39;]</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">as_datetime).replace(microsecond=0)</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">timedelta(seconds=1)</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="w"></span>
</code></pre></div>




  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateSubQueryRule.description">
<code class="highlight language-python"><span class="n">description</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateSubQueryRule.description" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>An optional description for the rule</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateSubQueryRule.exclude">
<code class="highlight language-python"><span class="n">exclude</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateSubQueryRule.exclude" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Similar to filters, but used to exclude results</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateSubQueryRule.filter_">
<code class="highlight language-python"><span class="n">filter_</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateSubQueryRule.filter_" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The filter/s to limit queried to documents to only those that match the filters</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateSubQueryRule.id_">
<code class="highlight language-python"><span class="n">id_</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
      <small class="doc doc-property doc-property-required"><code>required</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateSubQueryRule.id_" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The unique rule id</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateSubQueryRule.index">
<code class="highlight language-python"><span class="n">index</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateSubQueryRule.index" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The indices to query (by default prefixed with the dataset name)</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateSubQueryRule.indices_prefix_dataset">
<code class="highlight language-python"><span class="n">indices_prefix_dataset</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateSubQueryRule.indices_prefix_dataset" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>If set to true the <code>&lt;DATASET.name&gt;-</code> is automatically prefixed to each pattern. This is a convenience setting as per default all dataset indices start with this prefix.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateSubQueryRule.labels">
<code class="highlight language-python"><span class="n">labels</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
      <small class="doc doc-property doc-property-required"><code>required</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateSubQueryRule.labels" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The list of labels to apply to log lines matching this rule</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateSubQueryRule.query">
<code class="highlight language-python"><span class="n">query</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
      <small class="doc doc-property doc-property-required"><code>required</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateSubQueryRule.query" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The query/s to use for identifying log lines to apply the tags to.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateSubQueryRule.sub_query">
<code class="highlight language-python"><span class="n">sub_query</span><span class="p">:</span> <span class="n">QueryBase</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
      <small class="doc doc-property doc-property-required"><code>required</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateSubQueryRule.sub_query" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The templated sub query to use to apply the labels. Executed for each hit of the parent query.</p>
    </div>

  </div>




  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateSubQueryRule.type_field">
<code class="highlight language-python"><span class="n">type_field</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
      <small class="doc doc-property doc-property-required"><code>required</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateSubQueryRule.type_field" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The rule type as passed in from the config</p>
    </div>

  </div>









  </div>

    </div>

  </div>

<h2 id="dsl-parent-query-rule-elasticsearchparent_query">DSL Parent Query Rule (<code>elasticsearch.parent_query</code>)<a class="headerlink" href="#dsl-parent-query-rule-elasticsearchparent_query" title="Permanent link">&para;</a></h2>


  <div class="doc doc-object doc-class">


    <div class="doc doc-contents first">

      <p>Applies the labels to all rows of a base query for which
a parent query returns results.</p>
<p>This labeling rule first executes a base query to retrieve rows we might want
to apply labels to. It then renders and executes a templated parent query
for each retrieved row. The parent queries are then used to indicate if
the initial result row should be labeled or not. By default result rows of the
base query are labeled if the corresponding parent query returns at leas <em>one</em>
row. It is possible to configure this minimum number e.g., to require at least
two results.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The sub query uses Jinja2 syntax for templating. The information retrieved
by the base query can be accessed through the <code>HIT</code> variable.</p>
</div>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">elasticsearch.parent_query</span><span class="w"></span>
<span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">attacker.foothold.apache.error_access</span><span class="w"></span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">attacker_http</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foothold</span><span class="w"></span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;-</span><span class="w"></span>
<span class="w">    </span><span class="no">This rule looks for unlabeled error messages resulting from VPN server</span><span class="w"></span>
<span class="w">    </span><span class="no">traffic within the attack time and tries to match it to an already labeled</span><span class="w"></span>
<span class="w">    </span><span class="no">access log row.</span><span class="w"></span>
<span class="w">  </span><span class="nt">index</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apache_error-intranet_server</span><span class="w"></span>
<span class="w">  </span><span class="nt">query</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">match</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">source.address</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;172.16.100.151&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">filter</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="c1"># use script query to match only entries that</span><span class="w"></span>
<span class="w">    </span><span class="c1"># are not already tagged for as attacker http in the foothold phase</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">bool</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">must_not</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">script</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">script</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test_dataset_kyoushi_label_filter</span><span class="w"></span>
<span class="w">                </span><span class="nt">params</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="nt">labels</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">attacker_http</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">  </span><span class="nt">parent_query</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">index</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apache_access-intranet_server</span><span class="w"></span>
<span class="w">    </span><span class="nt">query</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">term</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">url.full</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">HIT.url.full</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">term</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">source.address</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">HIT.source.address</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="w"></span>
<span class="w">    </span><span class="c1"># we are looking for parents that are labeled as attacker http</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">bool</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">must</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">script</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="nt">script</span><span class="p">:</span><span class="w"></span>
<span class="w">                  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test_dataset_kyoushi_label_filter</span><span class="w"></span>
<span class="w">                  </span><span class="nt">params</span><span class="p">:</span><span class="w"></span>
<span class="w">                    </span><span class="nt">labels</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">attacker_http</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">    </span><span class="nt">filter</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">range</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="c1"># parent must be within +-1s of potential child</span><span class="w"></span>
<span class="w">          </span><span class="s">&quot;@timestamp&quot;</span><span class="p p-Indicator">:</span><span class="w"></span>
<span class="w">             </span><span class="nt">gte</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">(HIT[&#39;@timestamp&#39;]</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">as_datetime)</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">timedelta(seconds=1)</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="w"></span>
<span class="w">             </span><span class="nt">lte</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">(</span><span class="nv"> </span><span class="s">HIT[&#39;@timestamp&#39;]</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">as_datetime)</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">timedelta(seconds=1)</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="w"></span>
</code></pre></div>




  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateParentQueryRule.description">
<code class="highlight language-python"><span class="n">description</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateParentQueryRule.description" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>An optional description for the rule</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateParentQueryRule.exclude">
<code class="highlight language-python"><span class="n">exclude</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateParentQueryRule.exclude" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Similar to filters, but used to exclude results</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateParentQueryRule.filter_">
<code class="highlight language-python"><span class="n">filter_</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateParentQueryRule.filter_" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The filter/s to limit queried to documents to only those that match the filters</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateParentQueryRule.id_">
<code class="highlight language-python"><span class="n">id_</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
      <small class="doc doc-property doc-property-required"><code>required</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateParentQueryRule.id_" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The unique rule id</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateParentQueryRule.index">
<code class="highlight language-python"><span class="n">index</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateParentQueryRule.index" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The indices to query (by default prefixed with the dataset name)</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateParentQueryRule.indices_prefix_dataset">
<code class="highlight language-python"><span class="n">indices_prefix_dataset</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateParentQueryRule.indices_prefix_dataset" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>If set to true the <code>&lt;DATASET.name&gt;-</code> is automatically prefixed to each pattern. This is a convenience setting as per default all dataset indices start with this prefix.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateParentQueryRule.labels">
<code class="highlight language-python"><span class="n">labels</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
      <small class="doc doc-property doc-property-required"><code>required</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateParentQueryRule.labels" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The list of labels to apply to log lines matching this rule</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateParentQueryRule.max_result_window">
<code class="highlight language-python"><span class="n">max_result_window</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateParentQueryRule.max_result_window" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The max result window allowed on the elasticsearch instance</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateParentQueryRule.min_match">
<code class="highlight language-python"><span class="n">min_match</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateParentQueryRule.min_match" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The minimum number of parent matches needed for the main query to be labeled.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateParentQueryRule.parent_query">
<code class="highlight language-python"><span class="n">parent_query</span><span class="p">:</span> <span class="n">QueryBase</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
      <small class="doc doc-property doc-property-required"><code>required</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateParentQueryRule.parent_query" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The templated parent query to check if the labels should be applied to a query hit.</p>
    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateParentQueryRule.query">
<code class="highlight language-python"><span class="n">query</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
      <small class="doc doc-property doc-property-required"><code>required</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateParentQueryRule.query" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The query/s to use for identifying log lines to apply the tags to.</p>
    </div>

  </div>




  <div class="doc doc-object doc-attribute">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateParentQueryRule.type_field">
<code class="highlight language-python"><span class="n">type_field</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-pydantic-field"><code>pydantic-field</code></small>
      <small class="doc doc-property doc-property-required"><code>required</code></small>
  </span>

<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateParentQueryRule.type_field" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>The rule type as passed in from the config</p>
    </div>

  </div>







  <div class="doc doc-object doc-method">



<h4 class="doc doc-heading" id="cr_kyoushi.dataset.labels.UpdateParentQueryRule.check_parent">
<code class="highlight language-python"><span class="n">check_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_query</span><span class="p">,</span> <span class="n">min_match</span><span class="p">,</span> <span class="n">dataset_config</span><span class="p">,</span> <span class="n">es</span><span class="p">)</span></code>


<a class="headerlink" href="#cr_kyoushi.dataset.labels.UpdateParentQueryRule.check_parent" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Executes a parent query and returns if there were enough result rows.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>parent_query</code></td>
        <td><code>QueryBase</code></td>
        <td><p>The parent query to execute</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>min_match</code></td>
        <td><code>int</code></td>
        <td><p>The minimum number of result rows required</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>dataset_config</code></td>
        <td><code>DatasetConfig</code></td>
        <td><p>The dataset configuration</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>es</code></td>
        <td><code>Elasticsearch</code></td>
        <td><p>The elasticsearch client object</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p><code>True</code> if the query returned &gt;= min_match rows and <code>False</code> otherwise.</p></td>
    </tr>
  </tbody>
</table>
    </div>

  </div>





  </div>

    </div>

  </div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../processors/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Dataset Processors
              </div>
            </div>
          </a>
        
        
          <a href="../cli/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                CLI Reference
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.18f0862e.min.js"></script>
      <script src="../assets/javascripts/bundle.994580cf.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="../js/jquery-3.5.1.min.js"></script>
      
        <script src="../js/jquery.fancybox.min.js"></script>
      
    
  </body>
</html>